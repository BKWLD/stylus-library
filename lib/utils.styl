/**
 * Enable GPU caching of elements, which can fix weird layout issues but can
 * lead to fuzziness in text and other fine lines
 */
gpu-cache()
	backface-visibility hidden
	transform translate3d(0,0,0)

/**
 * Clearfix using psuedo elements.
 * http://nicolasgallagher.com/micro-clearfix-hack/
 */
clearfix()
	&:after
		content ""
		display table
		clear both

// Scale a property value between min-size and max-size with the width of the
// viewport until it is above or below the min-scale-width and max-scale-width
// values.  The values MUST BE UNITLESS.  This was done so that this could be
// used with CSS vars (ex: var(--)) and I could find no way in stylus to test
// for whether an argument was a css var or not; I kept getting fatal errors.
fluid(property,
	max-size,
	min-size = null,
	max-scale-width = null,
	min-scale-width = 375)

	// The multiplier applied when no min-width was set
	fluid-auto-min-size-factor ?= 0.5

	// Default max-scale-width to the max-width
	unless max-scale-width
		max-scale-width = unit(max-w, '')

	// Return the calc expression that sets a scaling value
	if min-size != null
		{property} 'calc(%s * 1px + (%s - %s)/(%s - %s) * (100vw - %s * 1px))' % (min-size max-size min-size max-scale-width min-scale-width min-scale-width)
	else
		{property} 'calc(%s * 1px * %s + (%s - %s * %s)/(%s - %s) * (100vw - %s * 1px))' % (max-size fluid-auto-min-size-factor max-size max-size fluid-auto-min-size-factor max-scale-width min-scale-width min-scale-width)

	// Cap it to min size when small
	@media(max-width min-scale-width * 1px)
		if min-size != null
			{property} 'calc(%s * 1px)' % min-size
		else
			{property} 'calc(%s * 1px * %s)' % (max-size fluid-auto-min-size-factor)

	// Cap it to max size when large
	@media(min-width max-scale-width * 1px)
		{property} 'calc(%s * 1px)' % max-size


/**
 * Adjust the provided property across a range of created media queries.
 *
 * @param property property A CSS property
 * @param number max-value  The value of the property at the max-width
 * @param number min-value  The value of the property at the min-width
 * @oaram unit max-width    The first break will be 1px narrower than this width
 * @oaram unit min-width    The final max-width break will be at this size
 * @param integer steps     How many breakpoints to create in between
 */
mq-values(property, max-value, min-value, max-width = 1400px, min-width = 500px, steps = 6)

	// Set intial value, essentially the widest browser setting
	{property} max-value

	// Loop through the range
	for i in 0...steps

		// If the first step, make the break 1 less that the max-width.  This makes
		// this function's API easier to understand, it makes it so the max-value
		// is available at the max-width but then the first break immediately follows.
		break = max-width - floor((max-width - min-width) * i / (steps - 1))
		if i == 0
			break -= 1px

		// Set the media query and value
		@media (max-width: break)
			{property} max-value - ((max-value - min-value) * (i + 1) / steps)


/**
 * Use vws for the unit of a prop until the break is reached
 *
 * @param prop property   A CSS property (without quotes)
 * @param number size     The vw value as a number
 * @param break unit(px)  The min-width breakpoint to switch to pixe;s
 */
vw-until(prop, size, break = max-w)
	size = unit(size, '')
	{prop} unit(size, vw)
	@media(min-width break)
		{prop} break * (size / 100)
